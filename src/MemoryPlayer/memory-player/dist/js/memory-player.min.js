/*! Memory Player module. Copyright 2015-2018 Adam De Lucia. */
!function(){"use strict";angular.module("MemoryPlayer",[])}();var MemoryPlayerProvider=function(){function a(){}return a.prototype.$get=function(){var a=this;return{ids:this.JPlayerIds,create:function(b){angular.isUndefined(a.JPlayer)&&(a.JPlayer=new jPlayerPlaylist(a.JPlayerIds,b,a.JPlayerOptions))},instance:function(){return a.JPlayer}}},a.prototype.$setIds=function(a){this.JPlayerIds=a},a.prototype.$setOptions=function(a){this.JPlayerOptions=a},a}();!function(){"use strict";angular.module("MemoryPlayer").provider("JPlayer",MemoryPlayerProvider)}();var MemoryPlayerConfig=function(){function a(a,b){this.$locationProvider=a,this.JPlayerProvider=b,this.JPlayerIds={jPlayer:"#mp-jquery_jplayer",cssSelectorAncestor:"#mp-jp_container"},this.JPlayerOptions={swfPath:"/js/jquery.jplayer.swf",supplied:"mp3",wmode:"window",audioFullScreen:!1,smoothPlayBar:!1,keyEnabled:!1,playlistOptions:{enableRemoveControls:!1,displayTime:0,addTime:0,removeTime:0,shuffleTime:0}},this.JPlayerProvider.$setIds(this.JPlayerIds),this.JPlayerProvider.$setOptions(this.JPlayerOptions),this.$locationProvider.html5Mode({enabled:!0,requireBase:!1})}return a.instance=["$locationProvider","JPlayerProvider",a],a}(),MemoryPlayerRun=function(){function a(a,b){var c=this;this.$rootScope=a,this.$window=b,this.$rootScope.$on("$locationChangeSuccess",function(a,b,d){b!==d&&(c.$window.location.href=b)})}return a.instance=["$rootScope","$window",a],a}();!function(){"use strict";angular.module("MemoryPlayer").config(MemoryPlayerConfig.instance).run(MemoryPlayerRun.instance)}();var MemoryPlayerAPI=function(){function a(a,b){this.$http=a,this.$log=b,this.playlists="/memory-player/dist/json/playlists.json"}return a.prototype.removePlayer=function(){angular.element("#memory-player").remove()},a.prototype.getPlaylists=function(){var a=this;return this.$http.get(this.playlists).then(function(b){return b.hasOwnProperty("data")&&null!==b.data?b.data:(a.removePlayer(),null)}).catch(function(b){return a.removePlayer(),a.$log.log("XHR Failed for getPlaylists."),b.data&&a.$log.log(b.data),null})},a.instance=["$http","$log",a],a}();!function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerAPI",MemoryPlayerAPI.instance)}();var MemoryPlayerControls=function(){function a(a,b,c){var d=this;this.$rootScope=a,this.JPlayer=b,this.MemoryPlayerState=c,this.jPlayerId=this.JPlayer.ids.jPlayer,this.$rootScope.$on("MP:Ready",function(a){angular.element(d.jPlayerId).bind($.jPlayer.event.volumechange,function(a){d.MemoryPlayerState.setVolume(a.jPlayer.options.volume),d.MemoryPlayerState.setIsMuted(a.jPlayer.options.muted)}),angular.element(d.jPlayerId).bind($.jPlayer.event.ended,function(){if(d.isEnd())d.$rootScope.$evalAsync(function(){d.selectTrack(0)});else{var a=d.MemoryPlayerState.getTrackId()+1;d.$rootScope.$evalAsync(function(){d.MemoryPlayerState.setTrack(a)})}})}),angular.element("#memory-player").on("click.mp.dropdown",".mp-dropdown-menu",function(a){a.stopPropagation()}),angular.element(document).on("click.mp.dropdown",function(a){var b=angular.element(".mp-dropdown");!angular.element(a.target).closest(".mp-dropdown-toggle").length&&b.hasClass("open")&&(b.removeClass("open"),b.find("a").attr("aria-expanded","false"))}),angular.element(document).on("click.mp.dropdown",".mp-dropdown-backdrop",function(a){angular.element(a.target).remove();var b=angular.element(".mp-dropdown");b.removeClass("open"),b.find("a").attr("aria-expanded","false")}),angular.element(document).on("YT.VideoPlayed",function(){d.MemoryPlayerState.getIsPaused()||d.$rootScope.$evalAsync(function(){d.play()})})}return a.prototype.isEnd=function(){return!(this.MemoryPlayerState.getTrackId()+1<this.MemoryPlayerState.getPlaylist().trackCount)},a.prototype.maxVolume=function(){this.MemoryPlayerState.getIsMuted()&&(angular.element(this.jPlayerId).jPlayer("unmute"),this.MemoryPlayerState.setIsMuted(!1)),angular.element(this.jPlayerId).jPlayer("volume",1)},a.prototype.mute=function(){var a=this.MemoryPlayerState.getIsMuted();a?angular.element(this.jPlayerId).jPlayer("unmute"):angular.element(this.jPlayerId).jPlayer("mute"),this.MemoryPlayerState.setIsMuted(!a)},a.prototype.next=function(){if(!this.isEnd()){var a=this.MemoryPlayerState.getTrackId()+1;this.MemoryPlayerState.setTrack(a),this.JPlayer.instance().next(),this.MemoryPlayerState.setIsPaused(!1)}},a.prototype.play=function(){var a=this.MemoryPlayerState.getIsPaused();a?this.JPlayer.instance().play():this.JPlayer.instance().pause(),this.MemoryPlayerState.setIsPaused(!a),a&&angular.element(this.jPlayerId).trigger("MP.TrackPlayed")},a.prototype.previous=function(){var a=this.MemoryPlayerState.getTrackId()-1;a>=0&&(this.MemoryPlayerState.setTrack(a),this.JPlayer.instance().previous(),this.MemoryPlayerState.setIsPaused(!1))},a.prototype.restart=function(a){this.MemoryPlayerState.setTrack(a.track),this.JPlayer.instance().select(a.track),angular.element(this.jPlayerId).jPlayer("volume",a.volume),!0===a.isMuted&&(angular.element(this.jPlayerId).jPlayer("mute"),this.MemoryPlayerState.setIsMuted(!0));var b="pause";!0!==a.isPaused&&(b="play",this.MemoryPlayerState.setIsPaused(!1)),angular.element(this.jPlayerId).jPlayer(b,a.time)},a.prototype.selectPlaylist=function(a){this.MemoryPlayerState.setPlaylist(a);var b=this.MemoryPlayerState.getPlaylist().tracks;this.JPlayer.instance().setPlaylist(b),this.JPlayer.instance().play(),this.MemoryPlayerState.setIsPaused(!1)},a.prototype.selectTrack=function(a){a!==this.MemoryPlayerState.getTrackId()?(this.MemoryPlayerState.setTrack(a),this.JPlayer.instance().play(a),this.MemoryPlayerState.setIsPaused(!1)):this.play()},a.prototype.showtime=function(a,b){var c=this;this.MemoryPlayerState.setPlaylist(a),this.JPlayer.create(this.MemoryPlayerState.getPlaylist().tracks),angular.element(this.jPlayerId).bind($.jPlayer.event.ready,function(){angular.isDefined(b)&&c.restart(b),c.$rootScope.$broadcast("MP:Ready"),angular.element("#memory-player").removeClass("mp-loading")})},a.prototype.toggleDropdown=function(a){var b=angular.element(event.target),c=b.closest(".mp-dropdown"),d=c.hasClass("open"),e=angular.element(document.createElement("div")).addClass("mp-dropdown-backdrop");angular.element(".mp-dropdown-backdrop").remove(),angular.element(".mp-dropdown-toggle").each(function(){angular.element(this).closest(".mp-dropdown").hasClass("open")&&(angular.element(this).closest(".mp-dropdown").removeClass("open"),angular.element(this).attr("aria-expanded","false"))}),d||("ontouchstart"in document.documentElement&&e.appendTo("body"),c.addClass("open"),b.closest(".mp-dropdown-toggle").attr("aria-expanded","true"))},a.instance=["$rootScope","JPlayer","MemoryPlayerState",a],a}();!function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerControls",MemoryPlayerControls.instance)}();var MemoryPlayerState=function(){function a(a){this.JPlayer=a,this.jPlayerId=this.JPlayer.ids.jPlayer,this.isMuted=!1,this.isPaused=!0,this.volume=.8}return a.prototype.getIsMuted=function(){return this.isMuted},a.prototype.setIsMuted=function(a){this.isMuted=a},a.prototype.getIsPaused=function(){return this.isPaused},a.prototype.setIsPaused=function(a){this.isPaused=a},a.prototype.getPlaylist=function(){return this.currentPlaylist},a.prototype.setPlaylist=function(a){this.currentPlaylist=this.playlists[a],this.setTrack(0)},a.prototype.getPlaylistId=function(){return this.currentPlaylist._id},a.prototype.getPlaylists=function(){return this.playlists},a.prototype.setPlaylists=function(a){this.playlists=a},a.prototype.getTime=function(){return Math.floor(angular.element(this.jPlayerId).data("jPlayer").status.currentTime)},a.prototype.getTrack=function(){return this.currentTrack},a.prototype.setTrack=function(a){this.currentTrack=this.currentPlaylist.tracks[a]},a.prototype.getTrackId=function(){return this.currentTrack._id},a.prototype.getVolume=function(){return this.volume.toFixed(2)},a.prototype.setVolume=function(a){this.volume=a},a.instance=["JPlayer",a],a}();!function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerState",MemoryPlayerState.instance)}();var MemoryPlayerSharing=function(){function a(a,b,c){var d=this;this.$rootScope=a,this.JPlayer=b,this.MemoryPlayerState=c,this.jPlayerId=this.JPlayer.ids.jPlayer,this.isTimeUsed=!1,this.sharelink=window.location.protocol+"//"+window.location.hostname+window.location.pathname,this.sharelinkTime="00:00",angular.isDefined(this.MemoryPlayerState.getPlaylist())&&this.setShareVal("playlist",this.MemoryPlayerState.getPlaylist()._id),angular.isDefined(this.MemoryPlayerState.getTrack())&&this.setShareVal("track",this.MemoryPlayerState.getTrack()._id),this.$rootScope.$watch(function(){return d.MemoryPlayerState.getPlaylist()},function(a,b){angular.isDefined(a)&&a!==b&&d.setShareVal("playlist",a._id)}),this.$rootScope.$watch(function(){return d.MemoryPlayerState.getTrack()},function(a,b){angular.isDefined(a)&&a!==b&&(d.setShareVal("track",a._id),d.isTimeUsed&&d.useTime())}),this.$rootScope.$on("MP:Ready",function(a){angular.element(d.jPlayerId).bind($.jPlayer.event.loadeddata,function(a){d.$rootScope.$evalAsync(function(){d.trackDuration=a.jPlayer.status.duration})})})}return a.prototype.cancelTimer=function(){angular.element(this.jPlayerId).unbind($.jPlayer.event.timeupdate)},a.prototype.setShareVal=function(a,b){var c=[],d={name:"playlist",value:null},e={name:"track",value:null},f={name:"time",value:0},g={name:"volume",value:.8},h={name:"isMuted",value:!1},i={name:"isPaused",value:!1},j=this.sharelink.split("?")[1]||null;if(angular.isString(j)){j=decodeURIComponent(j.replace(/\+/g,"%20"));j.split(/&(?!amp;)/g).map(function(a){var b=a.split("=");switch(b[0]){case"playlist":d.value=b[1];break;case"track":e.value=b[1];break;case"time":f.value=b[1]}})}switch(a){case"playlist":d.value=b;break;case"track":e.value=b;break;case"time":var k=b;k.indexOf(":")>-1&&(k=k.split(":").reverse().map(Number).reduce(function(a,b,c){return a+b*Math.pow(60,c)})),f.value=k<this.trackDuration?k:0}c.push(d),c.push(e),c.push(f),c.push(g),c.push(h),c.push(i);var l=$.param(c);this.sharelink=this.sharelink.split("?")[0]+"?"+l},a.prototype.share=function(){document.getElementById("mp-share-link").select(),document.execCommand("copy")},a.prototype.updateTime=function(a){this.isTimeUsed=!0,this.setShareVal("time",a)},a.prototype.useTime=function(){this.isTimeUsed=!this.isTimeUsed},a.instance=["$rootScope","JPlayer","MemoryPlayerState",a],a}();!function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerSharing",MemoryPlayerSharing.instance)}();var MemoryPlayerController=function(){function a(a,b,c,d){var e=this;this.$scope=a,this.MemoryPlayerState=b,this.MemoryPlayerControls=c,this.MemoryPlayerSharing=d,this.isShareable=!0,this.playlists=this.MemoryPlayerState.getPlaylists(),this.currentPlaylist=this.MemoryPlayerState.getPlaylist(),this.currentTrack=this.MemoryPlayerState.getTrack(),this.isPaused=this.MemoryPlayerState.getIsPaused(),this.$scope.$watch(function(){return e.MemoryPlayerState.getPlaylists()},function(a,b){angular.isDefined(a)&&a!==b&&(e.playlists=a)}),this.$scope.$watch(function(){return e.MemoryPlayerState.getPlaylist()},function(a,b){angular.isDefined(a)&&a!==b&&(e.currentPlaylist=a)}),this.$scope.$watch(function(){return e.MemoryPlayerState.getTrack()},function(a,b){angular.isDefined(a)&&a!==b&&(e.currentTrack=a)}),this.$scope.$watch(function(){return e.MemoryPlayerState.getIsPaused()},function(a,b){angular.isDefined(a)&&a!==b&&(e.isPaused=a)})}return a.prototype.cancelTimer=function(){this.MemoryPlayerSharing.cancelTimer()},a.prototype.maxVolume=function(){this.MemoryPlayerControls.maxVolume()},a.prototype.mute=function(){this.MemoryPlayerControls.mute()},a.prototype.next=function(){this.MemoryPlayerControls.next()},a.prototype.play=function(){this.MemoryPlayerControls.play()},a.prototype.previous=function(){this.MemoryPlayerControls.previous()},a.prototype.selectPlaylist=function(a){this.MemoryPlayerControls.selectPlaylist(a)},a.prototype.selectTrack=function(a){this.MemoryPlayerControls.selectTrack(a)},a.prototype.share=function(){this.MemoryPlayerSharing.share()},a.prototype.toggleDropdown=function(a){this.MemoryPlayerControls.toggleDropdown(a)},a.prototype.updateTime=function(a){this.MemoryPlayerSharing.updateTime(a)},a.prototype.useTime=function(){this.MemoryPlayerSharing.useTime()},a.instance=["$scope","MemoryPlayerState","MemoryPlayerControls","MemoryPlayerSharing",a],a}();!function(){"use strict";angular.module("MemoryPlayer").controller("MemoryPlayerController",MemoryPlayerController.instance)}();var MPPlayerController=function(){function a(a,b,c,d,e){var f=this;this.$rootScope=a,this.$location=b,this.MemoryPlayerAPI=c,this.MemoryPlayerState=d,this.MemoryPlayerControls=e;var g=this.$location.search();this.MemoryPlayerAPI.getPlaylists().then(function(a){if(f.MemoryPlayerState.setPlaylists(a),f.isRestartable(g)){var b={track:parseInt(g.track),time:parseInt(g.time),volume:parseFloat(g.volume),isMuted:g.isMuted,isPaused:g.isPaused};f.MemoryPlayerControls.showtime(g.playlist,b)}else{var c=Object.keys(a)[0];f.MemoryPlayerControls.showtime(a[c]._id)}}),this.unbindLocationChange=this.$rootScope.$on("$locationChangeStart",function(a,b,c){if(b!==c){var d=f.$location.url();f.$location.path(d.split("?")[0]).search({playlist:f.MemoryPlayerState.getPlaylistId(),track:f.MemoryPlayerState.getTrackId(),time:f.MemoryPlayerState.getTime(),volume:f.MemoryPlayerState.getVolume(),isMuted:f.MemoryPlayerState.getIsMuted(),isPaused:f.MemoryPlayerState.getIsPaused()})}})}return a.prototype.isRestartable=function(a){var b=!0;return a.hasOwnProperty("isMuted")||(b=!1),a.hasOwnProperty("isPaused")||(b=!1),a.hasOwnProperty("playlist")||(b=!1),a.hasOwnProperty("time")||(b=!1),a.hasOwnProperty("track")||(b=!1),a.hasOwnProperty("volume")||(b=!1),b},a.prototype.$onDestroy=function(){this.unbindLocationChange()},a.instance=["$rootScope","$location","MemoryPlayerAPI","MemoryPlayerState","MemoryPlayerControls",a],a}(),MemoryPlayerComponent=function(){function a(){this.controller=MPPlayerController.instance,this.controllerAs="player",this.bindings={cancelTimer:"&",currentPlaylist:"<",currentTrack:"<",isPaused:"<",isShareable:"<",maxVolume:"&",mute:"&",next:"&",play:"&",playlists:"<",previous:"&",selectPlaylist:"&",selectTrack:"&",share:"&",toggleDropdown:"&",updateTime:"&",useTime:"&"},this.templateUrl="/memory-player/dist/html/memory-player.html"}return a}();!function(){"use strict";angular.module("MemoryPlayer").component("memoryPlayer",new MemoryPlayerComponent)}();var MPSharingController=function(){function a(a,b,c){var d=this;this.$rootScope=a,this.JPlayer=b,this.MemoryPlayerSharing=c,this.sharelink=this.MemoryPlayerSharing.sharelink,this.isTimeUsed=!1,this.sharelinkTime="00:00",this.unbindSharelink=this.$rootScope.$watch(function(){return d.MemoryPlayerSharing.sharelink},function(a,b){angular.isDefined(a)&&a!==b&&(d.sharelink=a)}),this.unbindIsTimeUsed=this.$rootScope.$watch(function(){return d.MemoryPlayerSharing.isTimeUsed},function(a,b){angular.isDefined(a)&&a!==b&&(d.isTimeUsed=a,d.isTimeUsed?angular.element(d.JPlayer.ids.jPlayer).bind($.jPlayer.event.timeupdate,function(a){d.$rootScope.$evalAsync(function(){d.sharelinkTime=$.jPlayer.convertTime(a.jPlayer.status.currentTime),d.MemoryPlayerSharing.setShareVal("time",d.sharelinkTime)})}):(angular.element(d.JPlayer.ids.jPlayer).unbind($.jPlayer.event.timeupdate),d.sharelinkTime="00:00",d.MemoryPlayerSharing.setShareVal("time","0")))})}return a.prototype.$onDestroy=function(){this.unbindSharelink(),this.unbindIsTimeUsed()},a.instance=["$rootScope","JPlayer","MemoryPlayerSharing",a],a}(),MPSharingComponent=function(){function a(){this.controller=MPSharingController.instance,this.controllerAs="sharing",this.bindings={currentTrack:"<",cancelTimer:"&",share:"&",toggleDropdown:"&",updateTime:"&",useTime:"&"},this.templateUrl="/memory-player/dist/html/mp-sharing.html"}return a}();!function(){"use strict";angular.module("MemoryPlayer").component("mpSharing",new MPSharingComponent)}();