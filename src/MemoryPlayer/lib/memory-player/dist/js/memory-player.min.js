/*! Memory Player module. Copyright 2015-2018 Adam De Lucia. */!function(){"use strict";angular.module("MemoryPlayer",[])}();var MemoryPlayerAPI=function(){function a(a,b){this.$http=a,this.$log=b,this._endPoint="/lib/memory-player/dist/json/playlists.json"}return a.prototype._emptyAudioPlayer=function(){angular.element("#memory-player").remove()},a.prototype.getPlaylists=function(){var a=this;return this.$http.get(this._endPoint).then(function(b){return b.hasOwnProperty("data")&&null!==b.data?b.data:(a._emptyAudioPlayer(),null)}).catch(function(b){return a._emptyAudioPlayer(),a.$log.log("XHR Failed for getPlaylists."),b.data&&a.$log.log(b.data),null})},a}();MemoryPlayerAPI.instance=["$http","$log",MemoryPlayerAPI],function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerAPI",MemoryPlayerAPI.instance)}();var MemoryPlayerFactory=function(){function a(a,b,c){var d=this;this.$rootScope=a,this.$timeout=b,this.MemoryPlayerAPI=c,this._playlists=null,this._selectedPlaylist=null,this._selectedTrack=null,this._volume=.8,this._isMuted=!1,this.isPaused=!0,this._playerInstance=null,this._player={jPlayer:"#mp-jquery_jplayer",cssSelectorAncestor:"#mp-jp_container"},this._playerId=this._player.jPlayer,this._playerOptions={swfPath:"/js",supplied:"mp3",loadeddata:function(a){d.$rootScope.$emit("MemoryPlayer:trackLoaded",Math.floor(a.jPlayer.status.duration))},playing:function(){d.$rootScope.$emit("MemoryPlayer:trackPlayed")},volumechange:function(a){d._volume=a.jPlayer.options.volume,d._isMuted=a.jPlayer.options.muted},ended:function(){d.$rootScope.$emit("MemoryPlayer:trackEnded")},wmode:"window",audioFullScreen:!1,smoothPlayBar:!1,keyEnabled:!1,playlistOptions:{enableRemoveControls:!1}}}return a.instance=function(){var b=function(b,c,d){return new a(b,c,d)};return b.$inject=["$rootScope","$timeout","MemoryPlayerAPI"],b},a.prototype.getAllPlaylists=function(){return this._playlists},a.prototype.setAllPlaylists=function(a){this._playlists=a},a.prototype.fetchPlaylists=function(a){var b=this;this.MemoryPlayerAPI.getPlaylists().then(function(c){null!==c&&(b.setAllPlaylists(c),!!angular.isFunction(a)&&a())})},a.prototype.autoPlay=function(a){null!==this._playerInstance&&this._playerInstance.option("autoPlay",a)},a.prototype.getTime=function(){return Math.floor(angular.element(this._playerId).data("jPlayer").status.currentTime)},a.prototype.getVolume=function(){return this._volume.toFixed(2)},a.prototype.getIsMuted=function(){return this._isMuted},a.prototype.getTrack=function(){return this._selectedTrack},a.prototype.getPlaylist=function(){return this._selectedPlaylist},a.prototype.getTrackById=function(){return this._selectedTrack._id},a.prototype.getPlaylistById=function(){return this._selectedPlaylist._id},a.prototype.setTrack=function(a){this._selectedTrack=this.getPlaylist().playlist[a],this.$rootScope.$emit("MemoryPlayer:trackChanged",this._selectedTrack)},a.prototype.setPlaylist=function(a){this._selectedPlaylist=this.getAllPlaylists()[a],this.setTrack(0),null!==this._playerInstance&&(this._playerInstance.setPlaylist(this._selectedPlaylist.playlist),this.autoPlay(!0)),this.$rootScope.$emit("MemoryPlayer:playlistChanged",this._selectedPlaylist)},a.prototype.createPlayer=function(a,b){var c=this;this.setPlaylist(a),this._playerInstance=new jPlayerPlaylist(this._player,this.getPlaylist().playlist,this._playerOptions),angular.isDefined(b)?(this.setTrack(b.track),angular.element(this._playerId).on($.jPlayer.event.ready,function(){angular.element("#memory-player").removeClass("mp-loading"),c.$timeout(function(){c._playerInstance.select(b.track),angular.element(c._playerId).jPlayer("volume",b.volume),"false"!==b.isMuted&&(angular.element(c._playerId).jPlayer("mute"),c._isMuted=!0),"false"===b.isPaused?angular.element(c._playerId).jPlayer("play",b.time):angular.element(c._playerId).jPlayer("pause",b.time)},400)})):angular.element(this._playerId).on($.jPlayer.event.ready,function(){angular.element("#memory-player").removeClass("mp-loading")})},a.prototype.play=function(){this.isPaused?angular.element(this._playerId).jPlayer("play"):angular.element(this._playerId).jPlayer("pause"),this.isPaused=!this.isPaused,this.isPaused&&this.$rootScope.$emit("MemoryPlayer:isPaused",this.isPaused)},a.prototype.cueTrack=function(a){a!==this.getTrackById()?(this.setTrack(a),this._playerInstance.play(a)):this.play()},a.prototype.next=function(){var a=this.getTrackById();a+1<this.getPlaylist().trackCount&&(this.setTrack(a+1),this._playerInstance.next())},a.prototype.previous=function(){var a=this.getTrackById();a>0&&(this.setTrack(a-1),this._playerInstance.previous())},a.prototype.maxVolume=function(){this._isMuted&&(angular.element(this._playerId).jPlayer("unmute"),this._isMuted=!this._isMuted),angular.element(this._playerId).jPlayer("volume",1)},a.prototype.mute=function(){this.getIsMuted()?angular.element(this._playerId).jPlayer("unmute"):angular.element(this._playerId).jPlayer("mute"),this._isMuted=!this.getIsMuted()},a.prototype.trackPlayedEvent=function(a){this.isPaused=!1,angular.element(this._playerId).trigger("MemoryPlayer.trackPlayed"),angular.isFunction(a)&&a({isPaused:this.isPaused})},a.prototype.trackEndedEvent=function(a){var b=this.getTrackById();b+1===this.getPlaylist().trackCount?(this.setTrack(0),this.isPaused=!0,this._playerInstance.select(0)):this.setTrack(b+1),angular.isFunction(a)&&a({track:this.getTrack(),isPaused:this.isPaused})},a}();!function(){"use strict";angular.module("MemoryPlayer").factory("MemoryPlayerFactory",MemoryPlayerFactory.instance())}();var MemoryPlayerController=function(){function a(a,b,c,d,e){var f=this;this.$rootScope=a,this.$scope=b,this.$location=c,this.$interval=d,this.MemoryPlayerFactory=e,this.playlists=null,this.selectedPlaylist=null,this.selectedTrack=null,this.trackDuration=0,this.isPaused=!0,this.isShareable=!0,this.shareLink=window.location.protocol+"//"+window.location.hostname+window.location.pathname,this.isTimeUsed=!1,this.shareLinkTime="00:00",this.shareLinkTimer=null,this.$scope.$on("$locationChangeStart",function(a,b,c){if(b!==c){var d=f.$location.url();f.$location.path(d.split("?")[0]).search({playlist:f.MemoryPlayerFactory.getPlaylistById(),track:f.MemoryPlayerFactory.getTrackById(),time:f.MemoryPlayerFactory.getTime(),volume:f.MemoryPlayerFactory.getVolume(),isMuted:f.MemoryPlayerFactory.getIsMuted(),isPaused:f.MemoryPlayerFactory.isPaused})}}),this.$scope.$on("MemoryPlayer:directiveReady",function(a,b){f.MemoryPlayerFactory.fetchPlaylists(function(){if(f.playlists=f.MemoryPlayerFactory.getAllPlaylists(),null===b){for(var a in f.playlists)break;f.MemoryPlayerFactory.createPlayer(f.playlists[a]._id)}else f.MemoryPlayerFactory.createPlayer(b.playlist,b.info)})}),this.$rootScope.$on("MemoryPlayer:playlistChanged",function(a,b){f.selectedPlaylist=b,f.isShareable&&f.setShareLink("playlist",b._id)}),this.$rootScope.$on("MemoryPlayer:trackChanged",function(a,b){f.selectedTrack=b,f.isShareable&&(f.setShareLink("track",b._id),f.isTimeUsed&&f.useTime())}),this.$rootScope.$on("MemoryPlayer:trackLoaded",function(a,b){f.trackDuration=b}),this.$rootScope.$on("MemoryPlayer:isPaused",function(a,b){f.isShareable&&null!==f.shareLinkTimer&&f.$interval.cancel(f.shareLinkTimer),f.isPaused=b}),this.$rootScope.$on("MemoryPlayer:trackPlayed",function(){f.isShareable&&(null!==f.shareLinkTimer&&f.$interval.cancel(f.shareLinkTimer),f.shareLinkTimer=f.$interval(function(){f.shareLinkTime=$.jPlayer.convertTime(f.MemoryPlayerFactory.getTime())},1e3)),f.MemoryPlayerFactory.trackPlayedEvent(function(a){f.isPaused=a.isPaused,f.$scope.$apply()})}),this.$rootScope.$on("MemoryPlayer:trackEnded",function(){f.MemoryPlayerFactory.trackEndedEvent(function(a){f.selectedTrack=a.track,f.isPaused=a.isPaused,f.$scope.$apply()})}),angular.element(document).on("youtube.onVideoPlayed",function(){f.isPaused||(f.play(),f.$scope.$apply())}),angular.element(document).on("click.mp.dropdown",function(a){var b=angular.element(".mp-dropdown");!angular.element(a.target).closest(".mp-dropdown-toggle").length&&b.hasClass("open")&&(b.removeClass("open"),b.find("a").attr("aria-expanded","false"))}),angular.element(document).on("click.mp.dropdown",".mp-dropdown-backdrop",function(a){var b=angular.element(".mp-dropdown");angular.element(a.target).remove(),b.removeClass("open"),b.find("a").attr("aria-expanded","false")}),angular.element("#memory-player").on("click.mp.dropdown",".mp-dropdown-menu",function(a){a.stopPropagation()})}return a.prototype.setPlaylist=function(a){this.MemoryPlayerFactory.setPlaylist(a)},a.prototype.play=function(){this.MemoryPlayerFactory.play()},a.prototype.cueTrack=function(a){this.MemoryPlayerFactory.cueTrack(a)},a.prototype.next=function(){this.MemoryPlayerFactory.next()},a.prototype.previous=function(){this.MemoryPlayerFactory.previous()},a.prototype.maxVolume=function(){this.MemoryPlayerFactory.maxVolume()},a.prototype.mute=function(){this.MemoryPlayerFactory.mute()},a.prototype.setShareLink=function(a,b){var c=[],d={name:"playlist",value:null},e={name:"track",value:null},f={name:"time",value:0},g={name:"volume",value:.8},h={name:"isMuted",value:!1},i={name:"isPaused",value:!0},j=this.shareLink.split("?")[1]||null;if(null!==j){j=decodeURIComponent(j.replace(/\+/g,"%20"));for(var k=j.split(/&(?!amp;)/g),l=0,m=k.length;l<m;l++){var n=k[l].split("=");switch(n[0]){case"playlist":d.value=n[1];break;case"track":e.value=n[1];break;case"time":f.value=n[1]}}}switch(a){case"playlist":d.value=b;break;case"track":e.value=b;break;case"time":var o=b;o.indexOf(":")>-1&&(o=o.split(":").reverse().map(Number).reduce(function(a,b,c){return a+b*Math.pow(60,c)})),f.value=o<this.trackDuration?o:0}c.push(d),c.push(e),c.push(f),c.push(g),c.push(h),c.push(i),this.shareLink=this.shareLink.split("?")[0]+"?"+$.param(c)},a.prototype.useTime=function(){this.isTimeUsed=!this.isTimeUsed,this.isTimeUsed?this.setShareLink("time",this.shareLinkTime):this.setShareLink("time","0")},a.prototype.updateTime=function(){null!==this.shareLinkTimer&&this.$interval.cancel(this.shareLinkTimer),this.isTimeUsed=!0,this.setShareLink("time",this.shareLinkTime)},a.prototype.cancelTimer=function(){null!==this.shareLinkTimer&&this.$interval.cancel(this.shareLinkTimer)},a.prototype.share=function(){document.getElementById("mp-share-link").select(),document.execCommand("copy")},a.prototype.toggleDropdown=function(a){var b=angular.element(a.target),c=b.closest(".mp-dropdown"),d=c.hasClass("open"),e=angular.element(document.createElement("div")).addClass("mp-dropdown-backdrop");angular.element(".mp-dropdown-backdrop").remove(),angular.element(".mp-dropdown-toggle").each(function(){angular.element(this).closest(".mp-dropdown").hasClass("open")&&(angular.element(this).attr("aria-expanded","false"),angular.element(this).closest(".mp-dropdown").removeClass("open"))}),d||("ontouchstart"in document.documentElement&&e.appendTo("body"),c.addClass("open"),b.closest(".mp-dropdown-toggle").attr("aria-expanded","true"))},a}();MemoryPlayerController.instance=["$rootScope","$scope","$location","$interval","MemoryPlayerFactory",MemoryPlayerController],function(){"use strict";angular.module("MemoryPlayer").controller("MemoryPlayerController",MemoryPlayerController.instance)}();var MemoryPlayerDirective=function(){function a(b){var c=this;this.$location=b,this.restrict="A",this.scope=!0,this.replace=!0,this.templateUrl="/lib/memory-player/dist/html/memory-player.html",a.prototype.link=function(a,b,d){a.isShareable=a.$eval(d.isShareable)||!1;var e=c.$location.search();if(e.hasOwnProperty("playlist")&&e.hasOwnProperty("track")&&e.hasOwnProperty("time")&&e.hasOwnProperty("volume")&&e.hasOwnProperty("isMuted")&&e.hasOwnProperty("isPaused")){var f={track:parseInt(e.track),time:parseInt(e.time),volume:parseFloat(e.volume),isMuted:e.isMuted,isPaused:e.isPaused};a.$emit("MemoryPlayer:directiveReady",{playlist:e.playlist,info:f})}else a.$emit("MemoryPlayer:directiveReady",null)}}return a.instance=function(){var b=function(b){return new a(b)};return b.$inject=["$location"],b},a}();!function(){"use strict";angular.module("MemoryPlayer").directive("memoryPlayer",MemoryPlayerDirective.instance())}();