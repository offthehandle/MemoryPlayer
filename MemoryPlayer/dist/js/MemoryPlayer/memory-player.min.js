/*! Memory Player module. Copyright 2015-2017 Adam De Lucia. */!function(){"use strict";angular.module("MemoryPlayer",[])}();var MemoryPlayerAPI=function(){function a(a,b){this.$http=a,this.$log=b,this._endPoint="/dist/json/playlists.json"}return a.prototype._emptyAudioPlayer=function(){angular.element("#memory-player").remove()},a.prototype.getPlaylists=function(){var a=this;return this.$http.get(this._endPoint).then(function(b){return b.hasOwnProperty("data")&&null!==b.data?b.data:(a._emptyAudioPlayer(),null)}).catch(function(b){return a._emptyAudioPlayer(),a.$log.log("XHR Failed for getPlaylists."),b.data&&a.$log.log(b.data),null})},a.instance=["$http","$log",a],a}();!function(){"use strict";angular.module("MemoryPlayer").service("MemoryPlayerAPI",MemoryPlayerAPI.instance)}();var MemoryPlayerFactory=function(){function a(a,b,c){var d=this;this.$rootScope=a,this.$timeout=b,this.MemoryPlayerAPI=c,this._playlists=null,this._selectedPlaylist=null,this._selectedTrack=null,this._volume=.8,this._isMuted=!1,this.isPaused=!0,this._playerInstance=null,this._player={jPlayer:"#jquery_jplayer",cssSelectorAncestor:"#jp_container"},this._playerId=this._player.jPlayer,this._playerOptions={swfPath:"/Scripts",supplied:"mp3",playing:function(){d.$rootScope.$emit("MemoryPlayer:trackPlayed")},volumechange:function(a){d._volume=a.jPlayer.options.volume,d._isMuted=a.jPlayer.options.muted},ended:function(){d.$rootScope.$emit("MemoryPlayer:trackEnded")},wmode:"window",audioFullScreen:!1,smoothPlayBar:!1,keyEnabled:!1,playlistOptions:{enableRemoveControls:!1}}}return a.instance=function(){var b=function(b,c,d){return new a(b,c,d)};return b.$inject=["$rootScope","$timeout","MemoryPlayerAPI"],b},a.prototype.getAllPlaylists=function(){return this._playlists},a.prototype.setAllPlaylists=function(a){this._playlists=a},a.prototype.fetchPlaylists=function(a){var b=this;this.MemoryPlayerAPI.getPlaylists().then(function(c){null!==c&&(b.setAllPlaylists(c),!!angular.isFunction(a)&&a())})},a.prototype.autoPlay=function(a){null!==this._playerInstance&&this._playerInstance.option("autoPlay",a)},a.prototype.getTime=function(){return Math.floor(angular.element(this._playerId).data("jPlayer").status.currentTime)},a.prototype.getVolume=function(){return this._volume.toFixed(2)},a.prototype.getIsMuted=function(){return this._isMuted},a.prototype.getTrack=function(){return this._selectedTrack},a.prototype.getPlaylist=function(){return this._selectedPlaylist},a.prototype.getTrackById=function(){return this._selectedTrack._id},a.prototype.getPlaylistById=function(){return this._selectedPlaylist._id},a.prototype.setTrack=function(a){this._selectedTrack=this.getPlaylist().playlist[a],this.$rootScope.$emit("MemoryPlayer:trackChanged",this._selectedTrack)},a.prototype.setPlaylist=function(a){this._selectedPlaylist=this.getAllPlaylists()[a],this.setTrack(0),null!==this._playerInstance&&(this._playerInstance.setPlaylist(this._selectedPlaylist.playlist),this.autoPlay(!0)),this.$rootScope.$emit("MemoryPlayer:playlistChanged",this._selectedPlaylist)},a.prototype.createPlayer=function(a,b){var c=this;this.setPlaylist(a),this._playerInstance=new jPlayerPlaylist(this._player,this.getPlaylist().playlist,this._playerOptions),null!==b&&(this.setTrack(b.track),angular.element(this._playerId).on($.jPlayer.event.ready,function(){c.$timeout(function(){c._playerInstance.select(b.track),angular.element(c._playerId).jPlayer("volume",b.volume),"false"!==b.isMuted&&(angular.element(c._playerId).jPlayer("mute"),c._isMuted=!0),"false"===b.isPaused?angular.element(c._playerId).jPlayer("play",b.time):angular.element(c._playerId).jPlayer("pause",b.time)},400)}))},a.prototype.play=function(){this.isPaused?angular.element(this._playerId).jPlayer("play"):angular.element(this._playerId).jPlayer("pause"),this.isPaused=!this.isPaused,this.isPaused&&this.$rootScope.$emit("MemoryPlayer:isPaused",this.isPaused)},a.prototype.cueTrack=function(a){a!==this.getTrackById()?(this.setTrack(a),this._playerInstance.play(a)):this.play()},a.prototype.next=function(){var a=this.getTrackById();a+1<this.getPlaylist().trackCount&&(this.setTrack(a+1),this._playerInstance.next())},a.prototype.previous=function(){var a=this.getTrackById();a>0&&(this.setTrack(a-1),this._playerInstance.previous())},a.prototype.maxVolume=function(){this._isMuted&&(angular.element(this._playerId).jPlayer("unmute"),this._isMuted=!this._isMuted),angular.element(this._playerId).jPlayer("volume",1)},a.prototype.mute=function(){this.getIsMuted()?angular.element(this._playerId).jPlayer("unmute"):angular.element(this._playerId).jPlayer("mute"),this._isMuted=!this.getIsMuted()},a.prototype.trackPlayedEvent=function(a){this.isPaused=!1,angular.element(this._playerId).trigger("MemoryPlayer.trackPlayed"),angular.isFunction(a)&&a({isPaused:this.isPaused})},a.prototype.trackEndedEvent=function(a){var b=this.getTrackById();b+1===this.getPlaylist().trackCount?(this.setTrack(0),this.isPaused=!0,this._playerInstance.select(0)):this.setTrack(b+1),angular.isFunction(a)&&a({track:this.getTrack(),isPaused:this.isPaused})},a}();!function(){"use strict";angular.module("MemoryPlayer").factory("MemoryPlayerFactory",MemoryPlayerFactory.instance())}();var MemoryPlayerController=function(){function a(a,b,c,d){var e=this;this.$rootScope=a,this.$scope=b,this.$location=c,this.MemoryPlayerFactory=d,this.playlists=null,this.selectedPlaylist=null,this.selectedTrack=null,this.isPaused=!0,this.$scope.$on("$locationChangeStart",function(a,b,c){if(b!==c){var d=e.$location.url();e.$location.path(d.split("?")[0]).search({playlist:e.MemoryPlayerFactory.getPlaylistById(),track:e.MemoryPlayerFactory.getTrackById(),time:e.MemoryPlayerFactory.getTime(),volume:e.MemoryPlayerFactory.getVolume(),isMuted:e.MemoryPlayerFactory.getIsMuted(),isPaused:e.MemoryPlayerFactory.isPaused})}}),this.$scope.$on("MemoryPlayer:directiveReady",function(a,b){d.fetchPlaylists(function(){if(e.playlists=e.MemoryPlayerFactory.getAllPlaylists(),null===b){for(var a in e.playlists)break;e.MemoryPlayerFactory.createPlayer(e.playlists[a]._id,null)}else e.MemoryPlayerFactory.createPlayer(b.playlist,b.info)})}),this.$rootScope.$on("MemoryPlayer:trackChanged",function(a,b){e.selectedTrack=b}),this.$rootScope.$on("MemoryPlayer:playlistChanged",function(a,b){e.selectedPlaylist=b}),this.$rootScope.$on("MemoryPlayer:isPaused",function(a,b){e.isPaused=b}),this.$rootScope.$on("MemoryPlayer:trackPlayed",function(){e.MemoryPlayerFactory.trackPlayedEvent(function(a){e.isPaused=a.isPaused,e.$scope.$apply()})}),this.$rootScope.$on("MemoryPlayer:trackEnded",function(){e.MemoryPlayerFactory.trackEndedEvent(function(a){e.selectedTrack=a.track,e.isPaused=a.isPaused,e.$scope.$apply()})}),angular.element(document).on("youtube.onVideoPlayed",function(a){e.isPaused||(e.play(),e.$scope.$apply())})}return a.prototype.setPlaylist=function(a){this.MemoryPlayerFactory.setPlaylist(a)},a.prototype.play=function(){this.MemoryPlayerFactory.play()},a.prototype.cueTrack=function(a){this.MemoryPlayerFactory.cueTrack(a)},a.prototype.next=function(){this.MemoryPlayerFactory.next()},a.prototype.previous=function(){this.MemoryPlayerFactory.previous()},a.prototype.maxVolume=function(){this.MemoryPlayerFactory.maxVolume()},a.prototype.mute=function(){this.MemoryPlayerFactory.mute()},a.instance=["$rootScope","$scope","$location","MemoryPlayerFactory",a],a}();!function(){"use strict";angular.module("MemoryPlayer").controller("MemoryPlayerController",MemoryPlayerController.instance)}();var MemoryPlayerDirective=function(){function a(b){var c=this;this.$location=b,this.restrict="A",this.scope=!1,this.replace=!0,this.templateUrl="/dist/html/memory-player.html",a.prototype.link=function(a,b,d){var e=c.$location.search();if(e.hasOwnProperty("playlist")&&e.hasOwnProperty("track")&&e.hasOwnProperty("time")&&e.hasOwnProperty("volume")&&e.hasOwnProperty("isMuted")&&e.hasOwnProperty("isPaused")){var f={track:parseInt(e.track),time:parseInt(e.time),volume:parseFloat(e.volume),isMuted:e.isMuted,isPaused:e.isPaused};a.$emit("MemoryPlayer:directiveReady",{playlist:e.playlist,info:f})}else a.$emit("MemoryPlayer:directiveReady",null)}}return a.instance=function(){var b=function(b){return new a(b)};return b.$inject=["$location","MemoryPlayerFactory"],b},a}();!function(){"use strict";angular.module("MemoryPlayer").directive("memoryPlayer",MemoryPlayerDirective.instance())}();var MemoryPlayerDemo=angular.module("DemoApp",["MemoryPlayer"]);MemoryPlayerDemo.config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]),MemoryPlayerDemo.run(["$rootScope","$window",function(a,b){a.$on("$locationChangeSuccess",function(a,c,d){c!==d&&(b.location.href=c)})}]);